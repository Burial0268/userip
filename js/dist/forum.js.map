{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://gbcl-userip/./src/forum/Model/IPInfo.ts","webpack://gbcl-userip/./src/forum/ProcessData.tsx","webpack://gbcl-userip/./src/forum/components/GeoIpToolBar.tsx","webpack://gbcl-userip/./src/forum/extend.ts","webpack://gbcl-userip/./src/forum/index.tsx","webpack://gbcl-userip/external root \"flarum.core.compat['common/Component']\"","webpack://gbcl-userip/external root \"flarum.core.compat['common/Model']\"","webpack://gbcl-userip/external root \"flarum.core.compat['common/extend']\"","webpack://gbcl-userip/external root \"flarum.core.compat['common/extenders']\"","webpack://gbcl-userip/external root \"flarum.core.compat['common/models/Post']\"","webpack://gbcl-userip/external root \"flarum.core.compat['forum/app']\"","webpack://gbcl-userip/external root \"flarum.core.compat['forum/components/CommentPost']\"","webpack://gbcl-userip/./node_modules/.pnpm/@babel+runtime@7.22.5/node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://gbcl-userip/./node_modules/.pnpm/@babel+runtime@7.22.5/node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://gbcl-userip/webpack/bootstrap","webpack://gbcl-userip/webpack/runtime/compat get default export","webpack://gbcl-userip/webpack/runtime/define property getters","webpack://gbcl-userip/webpack/runtime/hasOwnProperty shorthand","webpack://gbcl-userip/webpack/runtime/make namespace object","webpack://gbcl-userip/./forum.ts"],"sourcesContent":["/*\n * This file is part of GBCLStudio Project.\n *\n * Copyright (c) 2023 GBCLStudio PHP Project Team.\n *\n * For the full copyright and license information, please view the LICENSE.md\n * file that was distributed with this source code.\n */\n\nimport { NestedStringArray } from '@askvortsov/rich-icu-message-formatter'\nimport Model from 'flarum/common/Model'\n\nexport default class IPInfo extends Model {\n  countryCode = Model.attribute<NestedStringArray>('countryCode')\n  region = Model.attribute<NestedStringArray>('region')\n  isp = Model.attribute<NestedStringArray>('isp')\n}\n","/*\n * This file is part of GBCLStudio Project.\n *\n * Copyright (c) 2023 GBCLStudio PHP Project Team.\n *\n * For the full copyright and license information, please view the LICENSE.md\n * file that was distributed with this source code.\n */\n\nimport { NestedStringArray } from '@askvortsov/rich-icu-message-formatter'\nimport ipinfo from './Model/IPInfo'\n\nexport default class ProcessData {\n  private region: NestedStringArray\n  private code: NestedStringArray\n  private isp: NestedStringArray\n\n  constructor(ipInfo: ipinfo) {\n    this.region = ipInfo.region()\n    this.code = ipInfo.countryCode()\n    this.isp = ipInfo.isp()\n  }\n\n  process(errorNotice: NestedStringArray) {\n    return [this.region, this.code, this.isp].reduce(\n      (acc, el, index) => {\n        let count = acc.count\n        if (el === null || el === undefined || el === '') {\n          ++count\n          el = errorNotice\n        }\n        acc.elements[index] = el\n        acc.count = count\n        return acc\n      },\n      { count: 0, elements: [] as NestedStringArray[] }\n    )\n  }\n}\n","/*\n * This file is part of GBCLStudio Project.\n *\n * Copyright (c) 2023 GBCLStudio PHP Project Team.\n *\n * For the full copyright and license information, please view the LICENSE.md\n * file that was distributed with this source code.\n */\n\nimport Component, { ComponentAttrs } from 'flarum/common/Component'\n\nexport interface GeoIpBarAttrs extends ComponentAttrs {\n  code: string\n  region: string\n  isp: string\n}\n\nexport default class GeoIpToolBar<\n  CustomAttrs extends GeoIpBarAttrs = GeoIpBarAttrs\n> extends Component<CustomAttrs> {\n  view() {\n    const { code, region, isp } = this.attrs\n    return (\n      <div className='userIp-container'>\n        <div className='ip-locate' id='info-country'>\n          {`${region}, ${code}`}\n        </div>\n        <div className='ip-locate' id='info-isp'>\n          {`${isp}`}\n        </div>\n      </div>\n    )\n  }\n}\n","/*\n * This file is part of GBCLStudio Project.\n *\n * Copyright (c) 2023 GBCLStudio PHP Project Team.\n *\n * For the full copyright and license information, please view the LICENSE.md\n * file that was distributed with this source code.\n */\n\nimport Extend from 'flarum/common/extenders'\nimport Post from 'flarum/common/models/Post'\nimport ipinfo from './Model/IPInfo'\n\nexport default [\n  new Extend.Model(Post)\n    .hasOne<ipinfo>('userip_info')\n    .attribute<ipinfo>('userIpInfo'),\n\n  new Extend.Store().add('userip_info', ipinfo),\n]\n","/*\n * This file is part of GBCLStudio Project.\n *\n * Copyright (c) 2023 GBCLStudio PHP Project Team.\n *\n * For the full copyright and license information, please view the LICENSE.md\n * file that was distributed with this source code.\n */\n\nimport app from 'flarum/forum/app'\nimport { extend } from 'flarum/common/extend'\nimport CommentPost from 'flarum/forum/components/CommentPost'\nimport Model from 'flarum/common/Model'\nimport ProcessData from './ProcessData'\nimport GeoIpToolBar from './components/GeoIpToolBar'\n\n// still learning\nexport { default as extend } from './extend'\n\napp.initializers.add('gbcl/userip', () => {\n  const errorNotice = app.translator.trans('gbcl-userip.forum.unknownNotice')\n\n  app.store.models.posts.prototype.userIpInfo = Model.hasOne('userip_info')\n\n  extend(CommentPost.prototype, 'footerItems', function (items) {\n    const ipInfo = this.attrs.post.userIpInfo()\n    if (!ipInfo) return\n\n    const result = new ProcessData(ipInfo).process(errorNotice)\n    const [reg, code, serv] = result.elements\n    const errorCount = result.count\n\n    if (errorCount < 2) {\n      items.add('userIp', <GeoIpToolBar region={reg} code={code} isp={serv} />)\n    }\n  })\n})\n","module.exports = flarum.core.compat['common/Component'];","module.exports = flarum.core.compat['common/Model'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['common/extenders'];","module.exports = flarum.core.compat['common/models/Post'];","module.exports = flarum.core.compat['forum/app'];","module.exports = flarum.core.compat['forum/components/CommentPost'];","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/*\n * This file is part of GBCLStudio Project.\n *\n * Copyright (c) 2023 GBCLStudio PHP Project Team.\n *\n * For the full copyright and license information, please view the LICENSE.md\n * file that was distributed with this source code.\n */\n\nexport * from './src/forum'\n"],"names":["Model","IPInfo","_Model","_inheritsLoose","_this","_len","arguments","length","args","Array","_key","call","apply","concat","countryCode","attribute","region","isp","default","ProcessData","ipInfo","code","_proto","prototype","process","errorNotice","reduce","acc","el","index","count","undefined","elements","Component","GeoIpToolBar","_Component","view","_this$attrs","attrs","m","className","id","Extend","Post","ipinfo","hasOne","Store","add","app","extend","CommentPost","initializers","translator","trans","store","models","posts","userIpInfo","items","post","result","_result$elements","reg","serv","errorCount","setPrototypeOf","subClass","superClass","Object","create","constructor","_setPrototypeOf","o","p","bind","__proto__"],"sourceRoot":""}